<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RB PRO LİG - Puan Durumu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: url('https://i.hizliresim.com/qoh3lui.png') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
    }
    .content {
      background-color: rgba(255, 255, 255, 0.9);
      margin: 20px;
      padding: 20px;
      border-radius: 10px;
    }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #1a2a6c;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f0f0f0;
    }
    .input-container {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    .input-container input, .input-container select {
      padding: 5px;
      margin: 5px;
      width: 200px;
      text-align: center;
    }
    .input-container button {
      padding: 8px 12px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
    }
    iframe {
      margin-top: 30px;
    }
    button {
      padding: 15px 30px;
      font-size: 24px;
      font-weight: bold;
      background-color: #1a2a6c;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover {
      background-color: #333;
    }
  </style>
</head>
<body>
  <div style="margin-top: 50px;">
    <button onclick="showScorePage()">RB PRO LİG</button>
    <button onclick="showTournamentPage()">101 OKEY</button>
  </div>

  <div id="homePage" class="content"></div>

  <div id="scorePage" class="content" style="display:none;">
    <h1>RB PRO LİG - Puan Durumu</h1>

    <h2>Yönetici Girişi</h2>
    <div class="input-container">
      <input type="text" id="username" placeholder="Kullanıcı Adı">
      <input type="password" id="password" placeholder="Şifre">
      <button onclick="adminLogin()">Giriş Yap</button>
    </div>

    <div id="adminSection" style="display:none;">
      <h2>Takım Yönetimi</h2>
      <div class="input-container">
        <input type="text" id="newTeamName" placeholder="Yeni Takım Adı">
        <button onclick="addTeam()">Takım Ekle</button>
      </div>
      <div class="input-container">
        <select id="removeTeamSelect"></select>
        <button onclick="removeTeam()">Takım Sil</button>
      </div>

      <h2>Yönetici Yönetimi</h2>
      <div class="input-container">
        <select id="selectTeamForTD"></select>
      </div>
      <div class="input-container">
        <input type="text" id="newTD" placeholder="Yeni Yönetici">
        <button onclick="addTD()">Yönetici Ekle</button>
      </div>
      <div class="input-container">
        <select id="removeTDSelect"></select>
        <button onclick="removeTD()">Yönetici Sil</button>
      </div>

      <h2>Maç Sonucu Ekle</h2>
      <div class="input-container">
        <select id="team1Select"></select>
        <input type="number" id="score1" placeholder="Takım 1 Skoru">
        <select id="team2Select"></select>
        <input type="number" id="score2" placeholder="Takım 2 Skoru">
        <button onclick="submitMatchResult()">Sonuç Ekle</button>
      </div>

      <h2>Puanları Sıfırla</h2>
      <button onclick="resetScores()">Puanları Sıfırla</button>
    </div>

    <table id="teamTable">
      <thead>
        <tr>
          <th>Sıra</th>
          <th>Takım</th>
          <th>G</th>
          <th>B</th>
          <th>M</th>
          <th>AG</th>
          <th>YG</th>
          <th>AV</th>
          <th>Puan</th>
          <th>Yönetici</th>
        </tr>
      </thead>
      <tbody id="teamBody"></tbody>
    </table>

    <iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/4RmSuRMlr17amYP0bKlxaf?utm_source=generator" width="100%" height="352" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
  </div>

  <div id="tournamentPage" class="content" style="display:none;">
    <h1>YAKINDA</h1>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDa2nVYD-40KAorypRWFNvoUkt7SlNDggw",
      authDomain: "rb-pro-lig.firebaseapp.com",
      databaseURL: "https://rb-pro-lig-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "rb-pro-lig",
      storageBucket: "rb-pro-lig.appspot.com",
      messagingSenderId: "418719104708",
      appId: "1:418719104708:web:e8f5edafd49279b0909391"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const correctUsername = "admin";
    const correctPassword = "admin123";

    function showScorePage() {
      document.getElementById("homePage").style.display = "none";
      document.getElementById("scorePage").style.display = "block";
      document.getElementById("tournamentPage").style.display = "none";
    }

    function showTournamentPage() {
      document.getElementById("homePage").style.display = "none";
      document.getElementById("scorePage").style.display = "none";
      document.getElementById("tournamentPage").style.display = "block";
    }

    function adminLogin() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      if (username === correctUsername && password === correctPassword) {
        document.getElementById("adminSection").style.display = "block";
        alert("Giriş başarılı!");
      } else {
        alert("Yanlış kullanıcı adı veya şifre!");
      }
    }

    async function fetchTeams() {
      const snapshot = await db.ref("teams").once("value");
      const teams = snapshot.val() || {};
      return teams;
    }

    async function populateTable() {
      const teams = await fetchTeams();
      const tableBody = document.getElementById("teamBody");
      tableBody.innerHTML = "";

      const sortedTeams = Object.entries(teams).sort(([, a], [, b]) => {
        if (b.points !== a.points) return b.points - a.points;
        return b.goalDiff - a.goalDiff;
      });

      sortedTeams.forEach(([teamName, data], index) => {
        const row = `<tr>
          <td>${index + 1}</td>
          <td>${teamName}</td>
          <td>${data.wins + data.draws + data.losses}</td>
          <td>${data.draws}</td>
          <td>${data.losses}</td>
          <td>${data.goals}</td>
          <td>${data.conceded}</td>
          <td>${data.goalDiff}</td>
          <td>${data.points}</td>
          <td>${data.td || ""}</td>
        </tr>`;
        tableBody.innerHTML += row;
      });

      populateDropdowns(teams);
    }

    function populateDropdowns(teams) {
      const teamSelects = ["team1Select", "team2Select", "removeTeamSelect", "selectTeamForTD", "removeTDSelect"];
      teamSelects.forEach(id => {
        const select = document.getElementById(id);
        select.innerHTML = "";
        Object.keys(teams).forEach(team => {
          const option = document.createElement("option");
          option.value = team;
          option.textContent = team;
          select.appendChild(option);
        });
      });
    }

    async function addTeam() {
      const teamName = document.getElementById("newTeamName").value;
      if (!teamName) return alert("Takım adı boş olamaz.");
      const ref = db.ref("teams/" + teamName);
      const snapshot = await ref.once("value");
      if (snapshot.exists()) return alert("Takım zaten mevcut.");

      const data = { wins: 0, draws: 0, losses: 0, goals: 0, conceded: 0, goalDiff: 0, points: 0, td: "" };
      await ref.set(data);
      document.getElementById("newTeamName").value = "";
      populateTable();
    }

    async function removeTeam() {
      const team = document.getElementById("removeTeamSelect").value;
      if (team) {
        await db.ref("teams/" + team).remove();
        populateTable();
      }
    }

    async function addTD() {
      const team = document.getElementById("selectTeamForTD").value;
      const td = document.getElementById("newTD").value;
      if (td && team) {
        await db.ref("teams/" + team + "/td").set(td);
        document.getElementById("newTD").value = "";
        populateTable();
      }
    }

    async function removeTD() {
      const team = document.getElementById("removeTDSelect").value;
      await db.ref("teams/" + team + "/td").remove();
      populateTable();
    }

    async function submitMatchResult() {
      const team1 = document.getElementById("team1Select").value;
      const team2 = document.getElementById("team2Select").value;
      const score1 = parseInt(document.getElementById("score1").value);
      const score2 = parseInt(document.getElementById("score2").value);
      if (team1 === team2) return alert("Aynı takım olamaz!");
      if (isNaN(score1) || isNaN(score2)) return alert("Geçerli skor girin.");

      const ref1 = db.ref("teams/" + team1);
      const ref2 = db.ref("teams/" + team2);
      const snapshot1 = await ref1.once("value");
      const snapshot2 = await ref2.once("value");

      const data1 = snapshot1.val();
      const data2 = snapshot2.val();

      data1.goals += score1;
      data1.conceded += score2;
      data1.goalDiff = data1.goals - data1.conceded;

      data2.goals += score2;
      data2.conceded += score1;
      data2.goalDiff = data2.goals - data2.conceded;

      if (score1 > score2) {
        data1.wins++;
        data2.losses++;
        data1.points += 3;
      } else if (score2 > score1) {
        data2.wins++;
        data1.losses++;
        data2.points += 3;
      } else {
        data1.draws++;
        data2.draws++;
        data1.points += 1;
        data2.points += 1;
      }

      await ref1.set(data1);
      await ref2.set(data2);
      populateTable();
    }

    async function resetScores() {
      const teams = await fetchTeams();
      const updates = {};
      for (const team of Object.keys(teams)) {
        updates[team] = { wins: 0, draws: 0, losses: 0, goals: 0, conceded: 0, goalDiff: 0, points: 0, td: teams[team].td || "" };
      }
      await db.ref("teams").set(updates);
      populateTable();
    }

    window.onload = () => {
      populateTable();
    };
  </script>
</body>
</html>
